{"ast":null,"code":"import _defineProperty from \"@babel/runtime/helpers/defineProperty\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/asyncToGenerator\";\nimport _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\nfunction ownKeys(e, r) { var t = Object.keys(e); if (Object.getOwnPropertySymbols) { var o = Object.getOwnPropertySymbols(e); r && (o = o.filter(function (r) { return Object.getOwnPropertyDescriptor(e, r).enumerable; })), t.push.apply(t, o); } return t; }\nfunction _objectSpread(e) { for (var r = 1; r < arguments.length; r++) { var t = null != arguments[r] ? arguments[r] : {}; r % 2 ? ownKeys(Object(t), !0).forEach(function (r) { _defineProperty(e, r, t[r]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(e, Object.getOwnPropertyDescriptors(t)) : ownKeys(Object(t)).forEach(function (r) { Object.defineProperty(e, r, Object.getOwnPropertyDescriptor(t, r)); }); } return e; }\nimport React, { createContext, useState, useContext, useEffect } from 'react';\nimport * as authService from \"../services/authService\";\nimport * as asyncStorage from \"../utils/asyncStorage\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nvar AuthContext = createContext();\nexport var useAuth = function useAuth() {\n  return useContext(AuthContext);\n};\nexport var AuthProvider = function AuthProvider(_ref) {\n  var children = _ref.children;\n  var _useState = useState(null),\n    _useState2 = _slicedToArray(_useState, 2),\n    user = _useState2[0],\n    setUser = _useState2[1];\n  var _useState3 = useState(true),\n    _useState4 = _slicedToArray(_useState3, 2),\n    loading = _useState4[0],\n    setLoading = _useState4[1];\n  var _useState5 = useState(null),\n    _useState6 = _slicedToArray(_useState5, 2),\n    error = _useState6[0],\n    setError = _useState6[1];\n  useEffect(function () {\n    var checkLoggedInUser = function () {\n      var _ref2 = _asyncToGenerator(function* () {\n        try {\n          var userData = yield asyncStorage.getStoredUser();\n          if (userData) {\n            setUser(userData);\n          }\n        } catch (err) {\n          console.error(\"Error retrieving stored user:\", err);\n        } finally {\n          setLoading(false);\n        }\n      });\n      return function checkLoggedInUser() {\n        return _ref2.apply(this, arguments);\n      };\n    }();\n    checkLoggedInUser();\n  }, []);\n  var login = function () {\n    var _ref3 = _asyncToGenerator(function* (username, password) {\n      try {\n        setError(null);\n        setLoading(true);\n        var userData = yield authService.login(username, password);\n        setUser(userData);\n        yield asyncStorage.storeUser(userData);\n        return userData;\n      } catch (err) {\n        setError(err.message || 'Failed to login');\n        throw err;\n      } finally {\n        setLoading(false);\n      }\n    });\n    return function login(_x, _x2) {\n      return _ref3.apply(this, arguments);\n    };\n  }();\n  var logout = function () {\n    var _ref4 = _asyncToGenerator(function* () {\n      try {\n        setLoading(true);\n        yield authService.logout();\n        setUser(null);\n        yield asyncStorage.clearUser();\n      } catch (err) {\n        setError(err.message || 'Failed to logout');\n      } finally {\n        setLoading(false);\n      }\n    });\n    return function logout() {\n      return _ref4.apply(this, arguments);\n    };\n  }();\n  var checkOut = function () {\n    var _ref5 = _asyncToGenerator(function* () {\n      try {\n        setLoading(true);\n        yield asyncStorage.clearSessionData();\n        if (user) {\n          var updatedUser = _objectSpread(_objectSpread({}, user), {}, {\n            currentSession: null\n          });\n          setUser(updatedUser);\n          yield asyncStorage.storeUser(updatedUser);\n        }\n      } catch (err) {\n        setError(err.message || 'Failed to check out');\n      } finally {\n        setLoading(false);\n      }\n    });\n    return function checkOut() {\n      return _ref5.apply(this, arguments);\n    };\n  }();\n  return _jsx(AuthContext.Provider, {\n    value: {\n      user: user,\n      loading: loading,\n      error: error,\n      login: login,\n      logout: logout,\n      checkOut: checkOut\n    },\n    children: children\n  });\n};","map":{"version":3,"names":["React","createContext","useState","useContext","useEffect","authService","asyncStorage","jsx","_jsx","AuthContext","useAuth","AuthProvider","_ref","children","_useState","_useState2","_slicedToArray","user","setUser","_useState3","_useState4","loading","setLoading","_useState5","_useState6","error","setError","checkLoggedInUser","_ref2","_asyncToGenerator","userData","getStoredUser","err","console","apply","arguments","login","_ref3","username","password","storeUser","message","_x","_x2","logout","_ref4","clearUser","checkOut","_ref5","clearSessionData","updatedUser","_objectSpread","currentSession","Provider","value"],"sources":["/home/runner/workspace/src/contexts/AuthContext.js"],"sourcesContent":["import React, { createContext, useState, useContext, useEffect } from 'react';\nimport * as authService from '../services/authService';\nimport * as asyncStorage from '../utils/asyncStorage';\n\nconst AuthContext = createContext();\n\nexport const useAuth = () => useContext(AuthContext);\n\nexport const AuthProvider = ({ children }) => {\n  const [user, setUser] = useState(null);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState(null);\n\n  useEffect(() => {\n    // Check if user is already logged in\n    const checkLoggedInUser = async () => {\n      try {\n        const userData = await asyncStorage.getStoredUser();\n        if (userData) {\n          setUser(userData);\n        }\n      } catch (err) {\n        console.error(\"Error retrieving stored user:\", err);\n      } finally {\n        setLoading(false);\n      }\n    };\n\n    checkLoggedInUser();\n  }, []);\n\n  const login = async (username, password) => {\n    try {\n      setError(null);\n      setLoading(true);\n      const userData = await authService.login(username, password);\n      setUser(userData);\n      // Store user data for persistence\n      await asyncStorage.storeUser(userData);\n      return userData;\n    } catch (err) {\n      setError(err.message || 'Failed to login');\n      throw err;\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const logout = async () => {\n    try {\n      setLoading(true);\n      await authService.logout();\n      setUser(null);\n      // Clear stored user data\n      await asyncStorage.clearUser();\n    } catch (err) {\n      setError(err.message || 'Failed to logout');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const checkOut = async () => {\n    try {\n      setLoading(true);\n      // Keep the user logged in but reset their session info\n      await asyncStorage.clearSessionData();\n      // Update user state to reflect the check out\n      if (user) {\n        const updatedUser = { ...user, currentSession: null };\n        setUser(updatedUser);\n        await asyncStorage.storeUser(updatedUser);\n      }\n    } catch (err) {\n      setError(err.message || 'Failed to check out');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  return (\n    <AuthContext.Provider value={{ \n      user, \n      loading, \n      error, \n      login, \n      logout,\n      checkOut\n    }}>\n      {children}\n    </AuthContext.Provider>\n  );\n};\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}