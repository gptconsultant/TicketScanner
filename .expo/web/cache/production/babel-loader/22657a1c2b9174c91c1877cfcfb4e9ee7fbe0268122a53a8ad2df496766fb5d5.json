{"ast":null,"code":"import _asyncToGenerator from\"@babel/runtime/helpers/asyncToGenerator\";import _defineProperty2 from\"@babel/runtime/helpers/defineProperty\";import _createClass from\"@babel/runtime/helpers/createClass\";import _classCallCheck from\"@babel/runtime/helpers/classCallCheck\";function ownKeys(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable;})),t.push.apply(t,o);}return t;}function _objectSpread(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?ownKeys(Object(t),!0).forEach(function(r){_defineProperty2(e,r,t[r]);}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):ownKeys(Object(t)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r));});}return e;}function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true});}else{obj[key]=value;}return obj;}import NativeInterface from\"./nativeInterface\";import InternetReachability from\"./internetReachability\";import*as PrivateTypes from\"./privateTypes\";var State=_createClass(function State(configuration){var _this=this;_classCallCheck(this,State);_defineProperty(this,\"_nativeEventSubscription\",null);_defineProperty(this,\"_subscriptions\",new Set());_defineProperty(this,\"_latestState\",null);_defineProperty(this,\"_internetReachability\",void 0);_defineProperty(this,\"_handleNativeStateUpdate\",function(state){_this._internetReachability.update(state);var convertedState=_this._convertState(state);_this._latestState=convertedState;_this._subscriptions.forEach(function(handler){return handler(convertedState);});});_defineProperty(this,\"_handleInternetReachabilityUpdate\",function(isInternetReachable){if(!_this._latestState){return;}var nextState=_objectSpread(_objectSpread({},_this._latestState),{},{isInternetReachable:isInternetReachable});_this._latestState=nextState;_this._subscriptions.forEach(function(handler){return handler(nextState);});});_defineProperty(this,\"_fetchCurrentState\",function(){var _ref=_asyncToGenerator(function*(requestedInterface){var state=yield NativeInterface.getCurrentState(requestedInterface);_this._internetReachability.update(state);var convertedState=_this._convertState(state);if(!requestedInterface){_this._latestState=convertedState;_this._subscriptions.forEach(function(handler){return handler(convertedState);});}return convertedState;});return function(_x){return _ref.apply(this,arguments);};}());_defineProperty(this,\"_convertState\",function(input){if(typeof input.isInternetReachable==='boolean'){return input;}else{return _objectSpread(_objectSpread({},input),{},{isInternetReachable:_this._internetReachability.currentState()});}});_defineProperty(this,\"latest\",function(requestedInterface){if(requestedInterface){return _this._fetchCurrentState(requestedInterface);}else if(_this._latestState){return Promise.resolve(_this._latestState);}else{return _this._fetchCurrentState();}});_defineProperty(this,\"add\",function(handler){_this._subscriptions.add(handler);if(_this._latestState){handler(_this._latestState);}else{_this.latest().then(handler);}});_defineProperty(this,\"remove\",function(handler){_this._subscriptions.delete(handler);});_defineProperty(this,\"tearDown\",function(){if(_this._internetReachability){_this._internetReachability.tearDown();}if(_this._nativeEventSubscription){_this._nativeEventSubscription.remove();}_this._subscriptions.clear();});this._internetReachability=new InternetReachability(configuration,this._handleInternetReachabilityUpdate);this._nativeEventSubscription=NativeInterface.eventEmitter.addListener(PrivateTypes.DEVICE_CONNECTIVITY_EVENT,this._handleNativeStateUpdate);this._fetchCurrentState();});export{State as default};","map":{"version":3,"names":["NativeInterface","InternetReachability","PrivateTypes","State","_createClass","configuration","_this","_classCallCheck","_defineProperty","Set","state","_internetReachability","update","convertedState","_convertState","_latestState","_subscriptions","forEach","handler","isInternetReachable","nextState","_objectSpread","_ref","_asyncToGenerator","requestedInterface","getCurrentState","_x","apply","arguments","input","currentState","_fetchCurrentState","Promise","resolve","add","latest","then","delete","tearDown","_nativeEventSubscription","remove","clear","_handleInternetReachabilityUpdate","eventEmitter","addListener","DEVICE_CONNECTIVITY_EVENT","_handleNativeStateUpdate","default"],"sources":["/home/runner/workspace/node_modules/@react-native-community/netinfo/lib/module/internal/state.ts"],"sourcesContent":["/**\n * Copyright (c) Facebook, Inc. and its affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @format\n */\n\nimport {NativeEventSubscription} from 'react-native';\nimport NativeInterface from './nativeInterface';\nimport InternetReachability from './internetReachability';\nimport * as Types from './types';\nimport * as PrivateTypes from './privateTypes';\n\nexport default class State {\n  private _nativeEventSubscription: NativeEventSubscription | null = null;\n  private _subscriptions = new Set<Types.NetInfoChangeHandler>();\n  private _latestState: Types.NetInfoState | null = null;\n  private _internetReachability: InternetReachability;\n\n  constructor(configuration: Types.NetInfoConfiguration) {\n    // Add the listener to the internet connectivity events\n    this._internetReachability = new InternetReachability(\n      configuration,\n      this._handleInternetReachabilityUpdate,\n    );\n\n    // Add the subscription to the native events\n    this._nativeEventSubscription = NativeInterface.eventEmitter.addListener(\n      PrivateTypes.DEVICE_CONNECTIVITY_EVENT,\n      this._handleNativeStateUpdate,\n    );\n\n    // Fetch the current state from the native module\n    this._fetchCurrentState();\n  }\n\n  private _handleNativeStateUpdate = (\n    state: PrivateTypes.NetInfoNativeModuleState,\n  ): void => {\n    // Update the internet reachability module\n    this._internetReachability.update(state);\n\n    // Convert the state from native to JS shape\n    const convertedState = this._convertState(state);\n\n    // Update the listeners\n    this._latestState = convertedState;\n    this._subscriptions.forEach((handler): void => handler(convertedState));\n  };\n\n  private _handleInternetReachabilityUpdate = (\n    isInternetReachable: boolean | null | undefined,\n  ): void => {\n    if (!this._latestState) {\n      return;\n    }\n\n    const nextState = {\n      ...this._latestState,\n      isInternetReachable,\n    } as Types.NetInfoState;\n    this._latestState = nextState;\n    this._subscriptions.forEach((handler): void => handler(nextState));\n  };\n\n  public _fetchCurrentState = async (\n    requestedInterface?: string,\n  ): Promise<Types.NetInfoState> => {\n    const state = await NativeInterface.getCurrentState(requestedInterface);\n\n    // Update the internet reachability module\n    this._internetReachability.update(state);\n    // Convert and store the new state\n    const convertedState = this._convertState(state);\n    if (!requestedInterface) {\n      this._latestState = convertedState;\n      this._subscriptions.forEach((handler): void => handler(convertedState));\n    }\n\n    return convertedState;\n  };\n\n  private _convertState = (\n    input: PrivateTypes.NetInfoNativeModuleState,\n  ): Types.NetInfoState => {\n    if (typeof input.isInternetReachable === 'boolean') {\n      return input as Types.NetInfoState;\n    } else {\n      return {\n        ...input,\n        isInternetReachable: this._internetReachability.currentState(),\n      } as Types.NetInfoState;\n    }\n  };\n\n  public latest = (\n    requestedInterface?: string,\n  ): Promise<Types.NetInfoState> => {\n    if (requestedInterface) {\n      return this._fetchCurrentState(requestedInterface);\n    } else if (this._latestState) {\n      return Promise.resolve(this._latestState);\n    } else {\n      return this._fetchCurrentState();\n    }\n  };\n\n  public add = (handler: Types.NetInfoChangeHandler): void => {\n    // Add the subscription handler to our set\n    this._subscriptions.add(handler);\n\n    // Send it the latest data we have\n    if (this._latestState) {\n      handler(this._latestState);\n    } else {\n      this.latest().then(handler);\n    }\n  };\n\n  public remove = (handler: Types.NetInfoChangeHandler): void => {\n    this._subscriptions.delete(handler);\n  };\n\n  public tearDown = (): void => {\n    if (this._internetReachability) {\n      this._internetReachability.tearDown();\n    }\n\n    if (this._nativeEventSubscription) {\n      this._nativeEventSubscription.remove();\n    }\n\n    this._subscriptions.clear();\n  };\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}