{"ast":null,"code":"import _defineProperty from\"@babel/runtime/helpers/defineProperty\";import _asyncToGenerator from\"@babel/runtime/helpers/asyncToGenerator\";import _objectWithoutProperties from\"@babel/runtime/helpers/objectWithoutProperties\";var _excluded=[\"facing\",\"poster\"];function ownKeys(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable;})),t.push.apply(t,o);}return t;}function _objectSpread(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?ownKeys(Object(t),!0).forEach(function(r){_defineProperty(e,r,t[r]);}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):ownKeys(Object(t)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r));});}return e;}import{CodedError}from'expo-modules-core';import{forwardRef,useRef,useMemo,useImperativeHandle}from'react';import StyleSheet from\"react-native-web/dist/exports/StyleSheet\";import View from\"react-native-web/dist/exports/View\";import createElement from'react-native-web/dist/exports/createElement';import CameraManager from\"./ExpoCameraManager.web\";import{capture}from\"./web/WebCameraUtils\";import{PictureSizes}from\"./web/WebConstants\";import{useWebCameraStream}from\"./web/useWebCameraStream\";import{useWebQRScanner}from\"./web/useWebQRScanner\";import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";var ExponentCamera=forwardRef(function(_ref,ref){var _props$barcodeScanner3;var facing=_ref.facing,poster=_ref.poster,props=_objectWithoutProperties(_ref,_excluded);var video=useRef(null);var native=useWebCameraStream(video,facing,props,{onCameraReady:function onCameraReady(){if(props.onCameraReady){props.onCameraReady();}},onMountError:props.onMountError});var isQRScannerEnabled=useMemo(function(){var _props$barcodeScanner,_props$barcodeScanner2;return Boolean(((_props$barcodeScanner=props.barcodeScannerSettings)==null?void 0:(_props$barcodeScanner2=_props$barcodeScanner.barcodeTypes)==null?void 0:_props$barcodeScanner2.includes('qr'))&&!!props.onBarcodeScanned);},[(_props$barcodeScanner3=props.barcodeScannerSettings)==null?void 0:_props$barcodeScanner3.barcodeTypes,props.onBarcodeScanned]);useWebQRScanner(video,{interval:300,isEnabled:isQRScannerEnabled,captureOptions:{scale:1,isImageMirror:native.type==='front'},onScanned:function onScanned(event){if(props.onBarcodeScanned){props.onBarcodeScanned(event);}}});useImperativeHandle(ref,function(){return{getAvailablePictureSizes:function(){var _getAvailablePictureSizes=_asyncToGenerator(function*(){return PictureSizes;});function getAvailablePictureSizes(){return _getAvailablePictureSizes.apply(this,arguments);}return getAvailablePictureSizes;}(),takePicture:function(){var _takePicture=_asyncToGenerator(function*(options){var _video$current,_video$current2;if(!video.current||((_video$current=video.current)==null?void 0:_video$current.readyState)!==((_video$current2=video.current)==null?void 0:_video$current2.HAVE_ENOUGH_DATA)){throw new CodedError('ERR_CAMERA_NOT_READY','HTMLVideoElement does not have enough camera data to construct an image yet.');}var settings=native.mediaTrackSettings;if(!settings){throw new CodedError('ERR_CAMERA_NOT_READY','MediaStream is not ready yet.');}return capture(video.current,settings,_objectSpread(_objectSpread({},options),{},{onPictureSaved:function onPictureSaved(picture){if(options.onPictureSaved){options.onPictureSaved(picture);}if(props.onPictureSaved){props.onPictureSaved({nativeEvent:{data:picture,id:-1}});}}}));});function takePicture(_x){return _takePicture.apply(this,arguments);}return takePicture;}(),resumePreview:function(){var _resumePreview=_asyncToGenerator(function*(){if(video.current){video.current.play();}});function resumePreview(){return _resumePreview.apply(this,arguments);}return resumePreview;}(),pausePreview:function(){var _pausePreview=_asyncToGenerator(function*(){if(video.current){video.current.pause();}});function pausePreview(){return _pausePreview.apply(this,arguments);}return pausePreview;}()};},[native.mediaTrackSettings,props.onPictureSaved]);var isMuted=true;var style=useMemo(function(){var isFrontFacingCamera=native.type===CameraManager.Type.front;return[StyleSheet.absoluteFill,styles.video,{transform:isFrontFacingCamera?[{scaleX:-1}]:undefined}];},[native.type]);return _jsxs(View,{pointerEvents:\"box-none\",style:[styles.videoWrapper,props.style],children:[_jsx(Video,{autoPlay:true,playsInline:true,muted:isMuted,poster:poster,pointerEvents:props.pointerEvents,ref:video,style:style}),props.children]});});export default ExponentCamera;var Video=forwardRef(function(props,ref){return createElement('video',_objectSpread(_objectSpread({},props),{},{ref:ref}));});var styles=StyleSheet.create({videoWrapper:{flex:1,alignItems:'stretch'},video:{width:'100%',height:'100%',objectFit:'cover'}});","map":{"version":3,"names":["CodedError","forwardRef","useRef","useMemo","useImperativeHandle","StyleSheet","View","createElement","CameraManager","capture","PictureSizes","useWebCameraStream","useWebQRScanner","jsx","_jsx","jsxs","_jsxs","ExponentCamera","_ref","ref","_props$barcodeScanner3","facing","poster","props","_objectWithoutProperties","_excluded","video","native","onCameraReady","onMountError","isQRScannerEnabled","_props$barcodeScanner","_props$barcodeScanner2","Boolean","barcodeScannerSettings","barcodeTypes","includes","onBarcodeScanned","interval","isEnabled","captureOptions","scale","isImageMirror","type","onScanned","event","getAvailablePictureSizes","_getAvailablePictureSizes","_asyncToGenerator","apply","arguments","takePicture","_takePicture","options","_video$current","_video$current2","current","readyState","HAVE_ENOUGH_DATA","settings","mediaTrackSettings","_objectSpread","onPictureSaved","picture","nativeEvent","data","id","_x","resumePreview","_resumePreview","play","pausePreview","_pausePreview","pause","isMuted","style","isFrontFacingCamera","Type","front","absoluteFill","styles","transform","scaleX","undefined","pointerEvents","videoWrapper","children","Video","autoPlay","playsInline","muted","create","flex","alignItems","width","height","objectFit"],"sources":["/home/runner/workspace/node_modules/expo-camera/src/ExpoCamera.web.tsx"],"sourcesContent":["import { CodedError } from 'expo-modules-core';\nimport {\n  type PropsWithChildren,\n  forwardRef,\n  useRef,\n  useMemo,\n  useImperativeHandle,\n  type ComponentProps,\n  type Ref,\n} from 'react';\nimport { StyleProp, StyleSheet, View, ViewStyle } from 'react-native';\nimport createElement from 'react-native-web/dist/exports/createElement';\n\nimport {\n  CameraNativeProps,\n  CameraCapturedPicture,\n  CameraPictureOptions,\n  CameraType,\n} from './Camera.types';\nimport CameraManager from './ExpoCameraManager.web';\nimport { capture } from './web/WebCameraUtils';\nimport { PictureSizes } from './web/WebConstants';\nimport { useWebCameraStream } from './web/useWebCameraStream';\nimport { useWebQRScanner } from './web/useWebQRScanner';\n\nexport interface ExponentCameraRef {\n  getAvailablePictureSizes: (ratio: string) => Promise<string[]>;\n  takePicture: (options: CameraPictureOptions) => Promise<CameraCapturedPicture>;\n  resumePreview: () => Promise<void>;\n  pausePreview: () => Promise<void>;\n}\n\nconst ExponentCamera = forwardRef(\n  (\n    { facing, poster, ...props }: PropsWithChildren<CameraNativeProps>,\n    ref: Ref<ExponentCameraRef>\n  ) => {\n    const video = useRef<HTMLVideoElement | null>(null);\n\n    const native = useWebCameraStream(video, facing as CameraType, props, {\n      onCameraReady() {\n        if (props.onCameraReady) {\n          props.onCameraReady();\n        }\n      },\n      onMountError: props.onMountError,\n    });\n\n    const isQRScannerEnabled = useMemo<boolean>(() => {\n      return Boolean(\n        props.barcodeScannerSettings?.barcodeTypes?.includes('qr') && !!props.onBarcodeScanned\n      );\n    }, [props.barcodeScannerSettings?.barcodeTypes, props.onBarcodeScanned]);\n\n    useWebQRScanner(video, {\n      interval: 300,\n      isEnabled: isQRScannerEnabled,\n      captureOptions: { scale: 1, isImageMirror: native.type === 'front' },\n      onScanned(event) {\n        if (props.onBarcodeScanned) {\n          props.onBarcodeScanned(event);\n        }\n      },\n    });\n\n    useImperativeHandle(\n      ref,\n      () => ({\n        async getAvailablePictureSizes(): Promise<string[]> {\n          return PictureSizes;\n        },\n        async takePicture(options: CameraPictureOptions): Promise<CameraCapturedPicture> {\n          if (!video.current || video.current?.readyState !== video.current?.HAVE_ENOUGH_DATA) {\n            throw new CodedError(\n              'ERR_CAMERA_NOT_READY',\n              'HTMLVideoElement does not have enough camera data to construct an image yet.'\n            );\n          }\n          const settings = native.mediaTrackSettings;\n          if (!settings) {\n            throw new CodedError('ERR_CAMERA_NOT_READY', 'MediaStream is not ready yet.');\n          }\n\n          return capture(video.current, settings, {\n            ...options,\n            // This will always be defined, the option gets added to a queue in the upper-level. We should replace the original so it isn't called twice.\n            onPictureSaved(picture) {\n              if (options.onPictureSaved) {\n                options.onPictureSaved(picture);\n              }\n              if (props.onPictureSaved) {\n                props.onPictureSaved({ nativeEvent: { data: picture, id: -1 } });\n              }\n            },\n          });\n        },\n        async resumePreview(): Promise<void> {\n          if (video.current) {\n            video.current.play();\n          }\n        },\n        async pausePreview(): Promise<void> {\n          if (video.current) {\n            video.current.pause();\n          }\n        },\n      }),\n      [native.mediaTrackSettings, props.onPictureSaved]\n    );\n\n    // TODO(Bacon): Create a universal prop, on native the microphone is only used when recording videos.\n    // Because we don't support recording video in the browser we don't need the user to give microphone permissions.\n    const isMuted = true;\n\n    const style = useMemo<StyleProp<ViewStyle>>(() => {\n      const isFrontFacingCamera = native.type === CameraManager.Type.front;\n      return [\n        StyleSheet.absoluteFill,\n        styles.video,\n        {\n          // Flip the camera\n          transform: isFrontFacingCamera ? [{ scaleX: -1 }] : undefined,\n        },\n      ];\n    }, [native.type]);\n\n    return (\n      <View pointerEvents=\"box-none\" style={[styles.videoWrapper, props.style]}>\n        <Video\n          autoPlay\n          playsInline\n          muted={isMuted}\n          poster={poster}\n          pointerEvents={props.pointerEvents}\n          ref={video}\n          style={style}\n        />\n        {props.children}\n      </View>\n    );\n  }\n);\n\nexport default ExponentCamera;\n\nconst Video = forwardRef(\n  (\n    props: ComponentProps<typeof View> & {\n      autoPlay?: boolean;\n      playsInline?: boolean;\n      muted?: boolean;\n      poster?: string;\n    },\n    ref: Ref<HTMLVideoElement>\n  ) => createElement('video', { ...props, ref })\n);\n\nconst styles = StyleSheet.create({\n  videoWrapper: {\n    flex: 1,\n    alignItems: 'stretch',\n  },\n  video: {\n    width: '100%',\n    height: '100%',\n    objectFit: 'cover',\n  },\n});\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}