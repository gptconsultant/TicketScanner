{"ast":null,"code":"import _asyncToGenerator from\"@babel/runtime/helpers/asyncToGenerator\";import _defineProperty from\"@babel/runtime/helpers/defineProperty\";import _slicedToArray from\"@babel/runtime/helpers/slicedToArray\";function ownKeys(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable;})),t.push.apply(t,o);}return t;}function _objectSpread(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?ownKeys(Object(t),!0).forEach(function(r){_defineProperty(e,r,t[r]);}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):ownKeys(Object(t)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r));});}return e;}import{useEffect,useState}from'react';import NetInfo from'@react-native-community/netinfo';import useScan from\"./useScan\";var useOfflineSync=function useOfflineSync(){var autoSync=arguments.length>0&&arguments[0]!==undefined?arguments[0]:true;var _useScan=useScan(),offlineCheckIns=_useScan.offlineCheckIns,syncOfflineCheckIns=_useScan.syncOfflineCheckIns,isOnline=_useScan.isOnline,isSyncing=_useScan.isSyncing;var _useState=useState({lastSyncAttempt:null,lastSuccessfulSync:null,pendingItems:offlineCheckIns.length}),_useState2=_slicedToArray(_useState,2),syncStatus=_useState2[0],setSyncStatus=_useState2[1];useEffect(function(){setSyncStatus(function(prev){return _objectSpread(_objectSpread({},prev),{},{pendingItems:offlineCheckIns.length});});},[offlineCheckIns]);useEffect(function(){var unsubscribe=NetInfo.addEventListener(function(state){if(state.isConnected&&!isSyncing&&autoSync&&offlineCheckIns.length>0){triggerSync();}});return function(){unsubscribe();};},[autoSync,offlineCheckIns,isSyncing]);var triggerSync=function(){var _ref=_asyncToGenerator(function*(){if(!isOnline){console.log('Cannot sync while offline');return{success:false,error:'Cannot sync while offline'};}if(isSyncing){console.log('Sync already in progress');return{success:false,error:'Sync already in progress'};}if(offlineCheckIns.length===0){console.log('No items to sync');return{success:true,synced:0,message:'No items to sync'};}setSyncStatus(function(prev){return _objectSpread(_objectSpread({},prev),{},{lastSyncAttempt:new Date()});});try{var result=yield syncOfflineCheckIns();setSyncStatus(function(prev){return _objectSpread(_objectSpread({},prev),{},{lastSuccessfulSync:new Date(),pendingItems:offlineCheckIns.length-((result==null?void 0:result.synced)||0)});});return _objectSpread({success:true},result);}catch(error){console.error('Sync failed:',error);return{success:false,error:error.message||'Sync failed'};}});return function triggerSync(){return _ref.apply(this,arguments);};}();return{syncStatus:syncStatus,triggerSync:triggerSync,isPending:offlineCheckIns.length>0,isSyncing:isSyncing};};export default useOfflineSync;","map":{"version":3,"names":["useEffect","useState","NetInfo","useScan","useOfflineSync","autoSync","arguments","length","undefined","_useScan","offlineCheckIns","syncOfflineCheckIns","isOnline","isSyncing","_useState","lastSyncAttempt","lastSuccessfulSync","pendingItems","_useState2","_slicedToArray","syncStatus","setSyncStatus","prev","_objectSpread","unsubscribe","addEventListener","state","isConnected","triggerSync","_ref","_asyncToGenerator","console","log","success","error","synced","message","Date","result","apply","isPending"],"sources":["/home/runner/workspace/src/hooks/useOfflineSync.js"],"sourcesContent":["import { useEffect, useState } from 'react';\nimport NetInfo from '@react-native-community/netinfo';\nimport useScan from './useScan';\n\nconst useOfflineSync = (autoSync = true) => {\n  const { offlineCheckIns, syncOfflineCheckIns, isOnline, isSyncing } = useScan();\n  const [syncStatus, setSyncStatus] = useState({\n    lastSyncAttempt: null,\n    lastSuccessfulSync: null,\n    pendingItems: offlineCheckIns.length,\n  });\n\n  // Update pendingItems when offlineCheckIns changes\n  useEffect(() => {\n    setSyncStatus(prev => ({\n      ...prev,\n      pendingItems: offlineCheckIns.length,\n    }));\n  }, [offlineCheckIns]);\n\n  // Listen for network status changes\n  useEffect(() => {\n    const unsubscribe = NetInfo.addEventListener(state => {\n      // If we're coming back online and auto-sync is enabled, try to sync\n      if (state.isConnected && !isSyncing && autoSync && offlineCheckIns.length > 0) {\n        triggerSync();\n      }\n    });\n    \n    return () => {\n      unsubscribe();\n    };\n  }, [autoSync, offlineCheckIns, isSyncing]);\n\n  // Trigger a manual sync\n  const triggerSync = async () => {\n    if (!isOnline) {\n      console.log('Cannot sync while offline');\n      return { success: false, error: 'Cannot sync while offline' };\n    }\n    \n    if (isSyncing) {\n      console.log('Sync already in progress');\n      return { success: false, error: 'Sync already in progress' };\n    }\n    \n    if (offlineCheckIns.length === 0) {\n      console.log('No items to sync');\n      return { success: true, synced: 0, message: 'No items to sync' };\n    }\n    \n    setSyncStatus(prev => ({\n      ...prev,\n      lastSyncAttempt: new Date(),\n    }));\n    \n    try {\n      const result = await syncOfflineCheckIns();\n      \n      setSyncStatus(prev => ({\n        ...prev,\n        lastSuccessfulSync: new Date(),\n        pendingItems: offlineCheckIns.length - (result?.synced || 0),\n      }));\n      \n      return { \n        success: true, \n        ...result \n      };\n    } catch (error) {\n      console.error('Sync failed:', error);\n      return { \n        success: false, \n        error: error.message || 'Sync failed' \n      };\n    }\n  };\n\n  return {\n    syncStatus,\n    triggerSync,\n    isPending: offlineCheckIns.length > 0,\n    isSyncing,\n  };\n};\n\nexport default useOfflineSync;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}